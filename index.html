<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="image/png" href="/images/favicon.ico"/>
        <style>
            body {
                font-family:'Courier New', Courier, monospace;
                background: #efefef;
            }
            .container {
                margin: 0 auto;
                max-width: 800px;
            }
            h2 {
                text-align: center;
                font-family: sans-serif;
                font-size: 40px;
            }
            .search {
                text-align: center;
                margin-bottom: 20px;
                margin-top: 50px;
            }
            input {
                position: relative;
                margin: 0 auto;
                padding: 12px;
                font-size: 16px;
                border-radius: 4px;
                border: none;
                box-shadow: 1px 1px 1px 1px white;
                font-family: 'Courier New', Courier, monospace;
                width: calc(100% - 30px);
                margin-bottom: 20px;
                max-width: 615px;
            }
            textarea {
                position: relative;
                margin: 0 auto;
                padding: 12px;
                font-size: 12px;
                border-radius: 4px;
                border: none;
                box-shadow: 1px 1px 1px 1px white;
                font-family: 'Courier New', Courier, monospace;
                width: calc(100% - 30px);
                margin-bottom: 20px;
                max-width: 800px;
                height: 150px;
                resize: none;
            }
            button {
                padding: 12px;
                margin-left: 12px;
                font-size: 16px;
                border: none;
                border-radius: 30px;
                cursor: pointer;
                background: teal;
                color: white;
            }
            button:hover, button:active {
                background: #056767;
            }
            .link {
                margin-bottom: 10px;
            }
            .link span {
                display: inline;
                margin-right: 8px;
                cursor: pointer;
            }
            a {
                display: inline;
                font-family: monospace;
                color: teal;
            }
            a:hover, a:active, a:visited {
                color: #024848;
            }
            #content {
                border: 1px solid #e4e4e4;
                padding: 20px;
                max-height: calc(100vh - 300px);
                margin: 0 auto;
                overflow: scroll;
                background: white;
                visibility: hidden;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h2>Linkifier</h2>
            <div class="search">
                <textarea id="xmlText" value="" placeholder="Paste here"></textarea>
                <!-- <input id="url" name="url" value="" placeholder="Enter url" autocomplete="off" /> -->
                <button type="button" onclick="parseXMLText()">Get Links</button>
            </div>
            <div><span>Total count</span> : <span id="count"></span></div>
            <div id="content" />
        </div>
        <script type="text/javascript">
            const urlRegex = /((?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?)/i;
            
            document.addEventListener('click', function(e) {
                const targetElement = e.target;
                if (targetElement.classList[0] === 'copyLink') {
                    copyToClipboard(e.target.getAttribute('data-url'));
                    e.preventDefault();
                    targetElement.innerHTML = '&#9989;';
                    setTimeout(function() {
                        targetElement.innerHTML = '&#128279;';
                    }, 3000);
                }
            })

            document.getElementById('xmlText').addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    onClick();
                }
            });

            function parseXMLText() {
                let count = 0;
                const xmlStr = document.getElementById('xmlText').value;
                let parsedContent = "";
                const splittedContent = xmlStr.split('</loc>');
                if (splittedContent.length > 0) {
                    splittedContent.forEach(function(str) {
                        const pageUrl = str.split('<loc>')[1] || str.split('<loc>')[0];
                        if (urlRegex.test(pageUrl) && pageUrl.indexOf('healthtap.com') !== -1) {
                            count += 1;
                            parsedContent += "<div class='link'><span class='copyLink' data-url='" + pageUrl + "'>&#128279;</span><a href='" + pageUrl + "' target='_blank' >" + pageUrl + "</a></div>";
                        }
                    })
                }
                if (parsedContent) {
                    setContent(parsedContent);
                    
                } else {
                    setContent("No urls found.");
                }
            }
            
            function setCount(count) {
                const contentElement = document.getElementById("count");
                contentElement.innerHTML = count;
            }
            
            function setContent(content) {
                const contentElement = document.getElementById("content");
                contentElement.innerHTML = content;
                contentElement.style.visibility = 'visible';
            }

            function onClick() {
                const url = document.getElementById('url').value;
                setContent("Processing...");
                if (urlRegex.test(url)) {
                    loadXMLDoc(url);
                } else {
                    setContent("Invalid url.");
                }
            }

            function copyToClipboard(str) {
                const el = document.createElement('textarea');
                el.value = str;
                el.setAttribute('readonly', '');
                el.style.position = 'absolute';
                el.style.left = '-99999px';
                document.body.appendChild(el);
                el.select();
                document.execCommand('copy');
                document.body.removeChild(el);
            }

            function loadXMLDoc(xmlUrl) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                    myFunction(this);
                    }
                };
                xmlhttp.open("GET", xmlUrl, true);
                xmlhttp.send();
            }

            function myFunction(xml) {
                var x, i, xmlDoc;
                xmlDoc = xml.responseXML;
                if (xmlDoc) {
                    let parsedContent = "";
                    x = xmlDoc.getElementsByTagName("loc");
                    for (i = 0; i < x.length; i++) {
                        const pageUrl = x[i].childNodes[0].nodeValue;
                        parsedContent += "<div class='link'><span class='copyLink' data-url='" + pageUrl + "'>&#128279;</span><a href='" + pageUrl + "' target='_blank' >" + pageUrl + "</a></div>";
                    }
                    setContent(parsedContent);
                } else {
                    setContent("Error processing file.");
                }
            }
        </script>
    </body>
</html>

